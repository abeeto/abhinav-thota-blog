---
layout: base.njk
---

<section class="wrapper section" data-padding="wide">
    <h1>{{ title }}</h1>
    {{ content | safe }}
</section>

{% if comments %}
    <section class="section comment-section" data-post-slug="{{ slug }}" x-data="commentSection" x-init="init()" data-padding="wide">
        <div class="wrapper flow" data-flow-margin="compact">
            <h2>Leave a comment</h2>        
            <!-- Comment form - always visible but disabled when not authenticated -->
            <form @submit.prevent="isAuthenticated ? postComment() : handleSignIn()">
                <textarea class="comment-textarea" x-model="content" placeholder="Your comment" required x-bind:disabled="!isAuthenticated"></textarea>
                <button type="submit" data-button-type="accent" x-text="isAuthenticated ? 'Post Comment' : 'Sign In to Comment'"></button>
            </form>
            <!-- Auth status display -->
            <div x-show="isAuthenticated" style="display: none;">
                <p>Signed in as <strong x-text="currentUser?.profile?.name || currentUser?.profile?.email"></strong></p>
                <button type="button" @click="handleSignOut()" data-button-type="muted">Sign Out</button>
            </div>
        </div>
        <div class = "wrapper flow">
            <div x-show="loading">Loading comments...</div>
            <template x-for="comment in comments" :key="comment.commentId">
                <div class="comment">
                    <div class="comment-meta">
                        <strong x-text="comment.userName"></strong>
                        <strong x-text="formatDate(comment.createdAt)"></strong>
                    </div>
                    <div class="comment-content">
                        <p x-text="comment.content"></p>
                    </div>
                    <button type="button" data-button-type="muted" @click="deleteComment(comment.commentId)">Delete</button>
                </div>
            </template>
        </div>
    </section>
{% endif %}